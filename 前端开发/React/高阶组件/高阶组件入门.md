# 什么是高阶组件
高阶组件（HOC）higher-order function,  是 React 中用于复用组件逻辑的一种高级技巧。HOC 自身不是 React API 的一部分，它是一种基于 React 的组合特性而形成的设计模式。

具体而言，**高阶组件是参数为组件，返回值为新组件的函数。**

```tsx
const HoC = Component => EnhancedComponent
```

```tsx
const withClassName = Component => props => (
  <Component {...props} className="my-class" />
)
```

```ad-tip
In the React community, it is very common to have the prefix **with** for HOCs.
```

组件是将 props 转换为 UI，而高阶组件是将组件转换为另一个组件。

HOC 不会修改传入的组件，也不会使用继承来复制其行为。相反，HOC 通过将组件_包装_在容器组件中来_组成_新组件。HOC 是纯函数，没有副作用。

HOC 不应该修改传入组件，而应该使用组合的方式，通过将组件包装在容器组件中实现功能。
why HOCs usually **spread the props** `{...props}` they receive on the component is because they tend to be transparent and only add the new behavior.

下面👇🏻 我们来看一个示例：

```ad-example

<iframe src="https://codesandbox.io/s/vigilant-phoebe-lli8mk" allow="fullscreen" allowfullscreen="" style="height: 100%; width: 100%; aspect-ratio: 16 / 9;"></iframe>


代码里实现了一个 withInnerWidth 高阶组件，它可以传递给被包裹的组件，组件宽度的参数。
可以看到随着宽度的变化，传入进去的 innerWidth 参数的值，随之改变。

~~~tsx
import { useState, useEffect } from "react";

const withInnerWidth = (Component) => (props) => {
  const [innerWidth, setInnerWidth] = useState(window.innerWidth);

  const handleResize = () => {
    setInnerWidth(window.innerWidth);
  };

  useEffect(() => {
    window.addEventListener("resize", handleResize);

    return () => {
      window.removeEventListener("resize", handleResize);
    };
  }, []);

  return <Component {...props} innerWidth={innerWidth} />;
};

const MyComponent = ({ innerWidth }) => {
  return <div>Inner Width: {innerWidth}</div>;
};

const MyComponentWithInnerWidth = withInnerWidth(MyComponent);

export default function App() {
  return (
    <div className="App">
      <MyComponentWithInnerWidth />
    </div>
  );
}
~~~
```

# 用 React Hook 改写
[[React Hook 入门]]

```ad-tip
The new React Hooks can easily replace an HOC by creating custom Hooks.
```

让我们用 Hook 去改写上面的 HOC 函数

[Hook Rewrite Hoc Example - CodeSandbox](https://codesandbox.io/s/jovial-vaughan-b82ixy)

```tsx
import { useState, useEffect } from "react";

function useInnerWidth() {
  const [innerWidth, setInnerWidth] = useState(window.innerWidth);

  const handleResize = () => {
    setInnerWidth(window.innerWidth);
  };

  useEffect(() => {
    window.addEventListener("resize", handleResize);

    return () => {
      window.removeEventListener("resize", handleResize);
    };
  }, []);

  return innerWidth;
}

const MyComponent = () => {
  const innerWidth = useInnerWidth();
  return <div>Inner Width (Hook): {innerWidth}</div>;
};

export default function App() {
  return (
    <div className="App">
      <MyComponent />
    </div>
  );
}

```

# 注意事项

# 参考
- [高阶组件 – React](https://zh-hans.reactjs.org/docs/higher-order-components.html)
